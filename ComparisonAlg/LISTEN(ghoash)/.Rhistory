if( max_degree == 1){
###
k = k + 1
Ome = solve( Sig[Ordering[1:(k-1)],Ordering[1:(k-1)]] )
scores = sapply(RemNodes, function(j) ( Sig[j,j] - Sig[j,Ordering[1:(k-1)]] %*% Ome %*% Sig[Ordering[1:(k-1)],j] ) )
#sapply(RemNodes, function(j) 1/( var(X[,j]) - cov(X[,j], X[,Ordering[1:(k-1)]]) %*% Ome %*% cov(X[,Ordering[1:(k-1)]],X[,j])  ) )
#scores = sapply(RemNodes, function(j) sum(lm(X[,j]~X[,Ordering[1:(k-1)]])$resid^2)/n )
}else{
k = k + 1
Z = NULL;
for(l in Ordering[1:(k-1)] ){
Z = cbind(Z, poly( X[,l], degree = max_degree, raw = T) )
}
###
#scores = sapply(RemNodes, function(j) mean(lm(X[,j]~Z)$resid^2))
scores = sapply(RemNodes, function(j) 1/solve(cov( cbind(X[,j], Z)))[1,1] )
}
#print(scores)
Ordering_j = which( scores == min(scores) )
if( length(Ordering_j) > 1){
Ordering[k] = RemNodes[sample(Ordering_j, 1)]
}else{
Ordering[k] = RemNodes[Ordering_j]
}
RemNodes = setdiff(RemNodes, Ordering)
}
Ordering[p] = RemNodes
return( Ordering )
}
Backward_Learning_fun = function(X, max_degree = 1){
#### Step 1): Finding the Ordering ####
p = ncol(X)
n = nrow(X)
Ordering = rep(0, p)
RemNodes = 1:p
k = p
while( length(RemNodes) > 1 ){
if(max_degree ==1){
scores = 1/diag(solve(cov( X[,RemNodes])))
}else{
scores = NULL
for(j in RemNodes){
Z = NULL;
for(l in setdiff(RemNodes,j) ){
Z = cbind(Z, poly( X[,l], degree = max_degree, raw = T) )
}
scores = c( scores, 1/solve(cov( cbind(X[,j], Z)))[1,1] )
#scores = c( scores, mean( lm(X[,j]~ Z)$resid^2) )
}
}
#
#scores = sapply(RemNodes, function(j) sum(lm(X[,j]~X[,setdiff(RemNodes,j)])$resid^2)/n )
#print(scores)
Ordering_j = which( scores == max(scores) )
if( length(Ordering_j) > 1){
Ordering[k] = RemNodes[sample(Ordering_j, 1)]
}else{
Ordering[k] = RemNodes[Ordering_j]
}
k = k - 1
RemNodes = setdiff(RemNodes, Ordering)
}
Ordering[1] = RemNodes
return( Ordering )
}
##################################
#####GSEM Learning Algorithm via Conditional Independence Test#########
GSEM_Algorithm_True = function(Sigma, direction ="forward", graph = NULL){
library(bnlearn)
p = ncol(Sigma)
RemNode = 1:p
pi_GSEM = NULL
Estimated_G = Estimated_O = matrix(0, p ,p)
evaluation_result_GSEM = evaluation_result_GSEM_MEC = NULL
####
Runtime = proc.time()[3]
#### Step 1): Finding the Ordering ####
if(direction == "forward"){
Ordering = rep(0, p)
RemNodes = 1:p
k = 1
Sig = Sigma
Ordering[k] = which.min( diag(Sig) )
RemNodes = setdiff(RemNodes, Ordering)
while( length(RemNodes) > 1 ){
###
k = k + 1
Ome = solve( Sig[Ordering[1:(k-1)],Ordering[1:(k-1)]] )
scores = sapply(RemNodes, function(j) ( Sig[j,j] - Sig[j,Ordering[1:(k-1)]] %*% Ome %*% Sig[Ordering[1:(k-1)],j] ) )
#print(scores)
Ordering_j = which( scores == min(scores) )
if( length(Ordering_j) > 1){
Ordering[k] = RemNodes[sample(Ordering_j, 1)]
}else{
Ordering[k] = RemNodes[Ordering_j]
}
RemNodes = setdiff(RemNodes, Ordering)
}
Ordering[p] = RemNodes
}else if(direction =="backward"){
Sig = Sigma
Ordering = rep(0, p)
RemNodes = 1:p
k = p
while( length(RemNodes) > 1 ){
scores = 1/diag(solve( Sig[RemNodes,RemNodes]))
Ordering_j = which( scores == max(scores) )
if( length(Ordering_j) > 1){
Ordering[k] = RemNodes[sample(Ordering_j, 1)]
}else{
Ordering[k] = RemNodes[Ordering_j]
}
k = k - 1
RemNodes = setdiff(RemNodes, Ordering)
}
Ordering[1] = RemNodes
}
#print( proc.time()[3]  - Runtime )
#### Step 2): Finding the Parents ####
B = graph
B[B!=0] =1
MEC = B + t(B)
S = NULL
for( i in Ordering){
S <- union(S, i)
MEC[i,S] <- 0
}
Estimated_G = t(MEC)
#library(corrplot)
#corrplot(Estimated_G[Ordering, Ordering])
####
Runtime = proc.time()[3] - Runtime
print(paste("Oracle takes: ", Runtime))
####
est_MEC = dag2cpdagAdj(Estimated_G)
####
if( !is.null(graph) ){
B = graph
B[B!=0] =1
MEC = B + t(B)
evaluation_result_GSEM = evaluation_fun( B, Estimated_G )
evaluation_result_GSEM_MEC = evaluation_fun( dag2cpdagAdj(B), est_MEC)
evaluation_result_GSEM2 = NULL
}
return(
list( DAG_Evaluation = evaluation_result_GSEM,
MEC_Evaluation = evaluation_result_GSEM_MEC,
Oracle = evaluation_result_GSEM2,
DAG = Estimated_G,
Ordering = Ordering,
Time = Runtime)
)
}
##################################
# Evaluation_Algorithm(20181005) is required #
##### GSEM_simulation_fun: Simulations for recovering GSEM ####
GSEM_simulation_fun = function(seed, n_real, p_real, d = 1, max_degree = 1, direction = "forward", alpha = 0.001, model = "HomoGSEM" ){
#This algorithm is for simulations using Gaussian SEM Learning_algorithm.
# Gaussian, beta_jk = (-2,-0.25) \cup (0.25, 2) for Homo , and  (-2,-1) \cup (1, 2) for Hetero
if(model =="homoGSEM"){
setwd("C:/2019GaussianSEM_SimulationResult/Data/Homo"); p = 200;
}
if(model =="heteroGSEM"){
#setwd("C:/2019GaussianSEM_SimulationResult/Data/Hetero"); p = 200;
setwd("C:/2020HGSEM_Simulation/Data/Hetero"); # p =3000;
}
if(model =="polyhomoGSEM"){
setwd("C:/2019GaussianSEM_SimulationResult/Data/PolyHomo")
p = 20;
}
if(model =="polyheteroGSEM"){
setwd("C:/2019GaussianSEM_SimulationResult/Data/PolyHetero")
p = 20;
}
if(model =="NonGSEM"){
setwd("C:/2019GaussianSEM_SimulationResult/Data/NonGauss")
p = 20;
}
if(model =="NonGSEM2"){
setwd("C:/2019GaussianSEM_SimulationResult/Data/NonGauss2")
p = 20;
}
if(model =="NonGPolySEM"){
setwd("C:/2019GaussianSEM_SimulationResult/Data/NonGPolySEM")
p = 20;
}
#setwd("C:/2019GaussianSEM_SimulationResult/Data/NonFaithful");p = 3
#GaussianDAG_filename = paste0("GaussianSEM_p",p,"_d",d,"_seed",seed,".Rdata")
GaussianDAG_filename = paste0("GaussianSEM_d",d,"_seed",seed,".Rdata")
load(GaussianDAG_filename)
synthetic.graph =DAGsamples
graph = synthetic.graph$true_Matrix[1:p_real, 1:p_real]
data = synthetic.graph$x[1:n_real,1:p_real]
if( 1 == 1  ){
result_GSEM = GSEM_Algorithm(data, alpha = alpha, direction = direction, graph = graph, max_degree = max_degree)
}else{
result_GSEM = NULL
}
return(result_GSEM)
}
#####GSEM Learning Algorithm via L1 regularized Regression #######################
GSEM_Algorithm2 = function(data, graph = NULL, lambda.lasso = 0.4, sparsity_level = 0.18){
library(glmnet)
tuning.parameter <- lambda.lasso
###################
X = as.matrix( data )
RemNode = 1:p
pi_GSEM = NULL
ScoreMatrix = matrix(0, p, p)
#### Finding Ordering ####
Time_GSEM = proc.time()[3]
#### ordering estimation ####
Ordering = rep(0, p)
Estimated_G = Estimated_O = matrix(0, p ,p)
RemNodes = 1:p
k = 1
Ordering[k] = which.min( sapply(RemNodes, function(j) var(X[,j]) ) )
RemNodes = setdiff(RemNodes, Ordering)
while( length(RemNodes) >1 ){
k = k + 1
Ordering[k] = RemNodes[which.min( sapply(RemNodes, function(j) sum(lm(X[,j]~X[,Ordering[1:(k-1)]])$resid^2)/n ) )]
RemNodes = setdiff(RemNodes, Ordering)
}
Ordering[p] = RemNodes
#### paremnts estimation
glm0 = glmnet(X[,rep(Ordering[1],2)], X[,Ordering[2]], family = "gaussian", alpha = 1, lambda = tuning.parameter )$beta
if( sum( glm0[,1] != 0)   ){
Estimated_G[Ordering[2], Ordering[1]] = 1
}
for(k in 3:p){
glm0 = glmnet(X[, Ordering[1:(k-1)]], X[,Ordering[k]], family = "gaussian", alpha = 1, lambda = tuning.parameter )$beta
if( sum( glm0[,1] != 0)   ){
parents = which( glm0[,1] != 0 )
Estimated_G[Ordering[k], Ordering[parents]] = 1
}
}
if( !is.null(graph) ){
B = graph
B[B!=0] =1
MEC = B + t(B)
Oracle_DAG = estimated_graph_fun( MEC, Ordering )
evaluation_result_GSEM = evaluation_fun( B, Estimated_G )
evaluation_result_GSEM_MEC = evaluation_fun( dag2cpdagAdj(B), dag2cpdagAdj(Estimated_G) )
evaluation_result_GSEM_Oracle = evaluation_fun( B, Oracle_DAG )
}
return( list( DAG_Evaluation = evaluation_result_GSEM,
MEC_Evaluation = evaluation_result_GSEM_MEC,
Oracle_Evaluation = evaluation_result_GSEM_Oracle,
DAG = Estimated_G,
Ordering = Ordering ,
Time = Time_GSEM) )
}
####################
#RawData = GSEM_generator( n, p, d, noiseVar, beta_min, beta_max, graph_type, seed = 1)
#GSEM_Algorithm(data, graph, lambda.lasso = 0.4, sparsity_level = 1)$DAG_Evaluation
require(tidyverse)
require(ggmap)
require(reshape2)
require(glmnet)
covid = read.csv("C:/Users/Sion Park/Downloads/covid_19_data.csv/covid_19_data.csv")
covid = covid %>% filter(Country.Region == 'Mainland China') %>% select(c(2,3,6)) %>%
group_by(ObservationDate, Province.State) %>% summarise(sum(Confirmed))
colnames(covid)[3] = 'Confirmed'
covid$ObservationDate = paste0(substr(covid$ObservationDate,7,10),'-',substr(covid$ObservationDate,1,2),'-',substr(covid$ObservationDate,4,5))
covid$ObservationDate = as.Date(covid$ObservationDate)
covid_cast = dcast(covid,ObservationDate ~Province.State ,value.var = 'Confirmed' )
covid_cast[is.na(covid_cast)] = 0
covid_new = covid_cast[2:nrow(covid_cast),2:ncol(covid_cast)] - covid_cast[1:(nrow(covid_cast)-1),2:ncol(covid_cast)]
covid_new = rbind(covid_cast[1,2:ncol(covid_cast)], covid_new)
rownames(covid_new) = covid_cast$ObservationDate
covid_new_temp = covid_new[(rownames(covid_new)>'2020-01-20'& rownames(covid_new)<'2020-04-31'),]
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'backward', lambda_lasso = 1e-5,
lambda_lasso_G = 6 , sparsity_level = 0, max_degree = 1)
Result = GSEM_Algorithm(data = covid_new_temp,
graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.7)
################################ korea
require(tidyverse)
require(ggmap)
require(reshape2)
require(glmnet)
covid = read.csv("C:/Users/Sion Park/Downloads/covid_19_data.csv/covid_19_data.csv")
covid = covid %>% filter(Country.Region == 'Mainland China') %>% select(c(2,3,6)) %>%
group_by(ObservationDate, Province.State) %>% summarise(sum(Confirmed))
colnames(covid)[3] = 'Confirmed'
covid$ObservationDate = paste0(substr(covid$ObservationDate,7,10),'-',substr(covid$ObservationDate,1,2),'-',substr(covid$ObservationDate,4,5))
covid$ObservationDate = as.Date(covid$ObservationDate)
covid_cast = dcast(covid,ObservationDate ~Province.State ,value.var = 'Confirmed' )
covid_cast[is.na(covid_cast)] = 0
covid_new = covid_cast[2:nrow(covid_cast),2:ncol(covid_cast)] - covid_cast[1:(nrow(covid_cast)-1),2:ncol(covid_cast)]
covid_new = rbind(covid_cast[1,2:ncol(covid_cast)], covid_new)
rownames(covid_new) = covid_cast$ObservationDate
covid_new_temp = covid_new[(rownames(covid_new)>'2020-01-20'& rownames(covid_new)<'2020-04-31'),]
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'backward', lambda_lasso = 1e-5,
lambda_lasso_G = 6 , sparsity_level = 0, max_degree = 1)
# Result = GSEM_Algorithm(data = covid_new_temp,
#                         graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.7)
################################ korea
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From_X),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.7)
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = factor(From_X)),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.7)
direction
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.7)
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'backward', lambda_lasso = 1e-5,
lambda_lasso_G = 5 , sparsity_level = 0, max_degree = 1)
# Result = GSEM_Algorithm(data = covid_new_temp,
#                         graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)
1/(nrow(covid_new_temp))^(1/5)
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'backward', lambda_lasso = 1e-5,
lambda_lasso_G = 1/(nrow(covid_new_temp))^(1/5) , sparsity_level = 0, max_degree = 1)
# Result = GSEM_Algorithm(data = covid_new_temp,
#                         graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'backward', lambda_lasso = 1e-5,
lambda_lasso_G = 10/(nrow(covid_new_temp))^(1/5) , sparsity_level = 0, max_degree = 1)
# Result = GSEM_Algorithm(data = covid_new_temp,
#                         graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'forward', lambda_lasso = 1e-5,
lambda_lasso_G = 10/(nrow(covid_new_temp))^(1/5) , sparsity_level = 0, max_degree = 1)
# Result = GSEM_Algorithm(data = covid_new_temp,
#                         graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)
################################ korea
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)+
ggtitle('COVID-19 in China')+
theme(title  =  element_text(hjust = 0.5))
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)+
ggtitle('COVID-19 in China')+
theme(title  =  element_text(hjust = 0.5))
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)+
ggtitle('COVID-19 in China')+
theme(title  =  element_line(hjust = 0.5))
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)+
ggtitle('COVID-19 in China')+
theme(title  =  element_text(hjust = 0.5))
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)+
ggtitle('COVID-19 in China')+
theme(plot.title  =  element_text(hjust = 0.5))
require(tidyverse)
require(ggmap)
require(reshape2)
require(glmnet)
covid = read.csv("C:/Users/Sion Park/Downloads/covid_19_data.csv/covid_19_data.csv")
covid = covid %>% filter(Country.Region == 'Mainland China') %>% select(c(2,3,6)) %>%
group_by(ObservationDate, Province.State) %>% summarise(sum(Confirmed))
colnames(covid)[3] = 'Confirmed'
covid$ObservationDate = paste0(substr(covid$ObservationDate,7,10),'-',substr(covid$ObservationDate,1,2),'-',substr(covid$ObservationDate,4,5))
covid$ObservationDate = as.Date(covid$ObservationDate)
covid_cast = dcast(covid,ObservationDate ~Province.State ,value.var = 'Confirmed' )
covid_cast[is.na(covid_cast)] = 0
covid_new = covid_cast[2:nrow(covid_cast),2:ncol(covid_cast)] - covid_cast[1:(nrow(covid_cast)-1),2:ncol(covid_cast)]
covid_new = rbind(covid_cast[1,2:ncol(covid_cast)], covid_new)
rownames(covid_new) = covid_cast$ObservationDate
covid_new_temp = covid_new[(rownames(covid_new)>'2020-01-20'& rownames(covid_new)<'2020-04-31'),]
Result = GSEM_Algorithm_lasso(data = covid_new_temp,
graph = NULL, direction = 'backward', lambda_lasso = 1e-5,
lambda_lasso_G = 10/(nrow(covid_new_temp))^(1/5) , sparsity_level = 0, max_degree = 1)
# Result = GSEM_Algorithm(data = covid_new_temp,
#                         graph = NULL, direction = 'backward', alpha= 0.001, max_degree = 1)
# Result = GSEM_Algorithm_lasso2(data = covid_new_temp, graph = NULL, direction = 'backward',
#                                  lambda_lasso = 1e-5, alpha = 2, sparsity_level = 0, max_degree = 1)
Region = read.csv('C:/Users/Sion Park/Downloads/covid_19_data.csv/region.csv')
DAG = Result$DAG %>% as.data.frame()
colnames(DAG) = rownames(DAG) = Region$address
DAG = cbind(rownames(DAG), DAG) ; colnames(DAG)[1] = 'Address'
direction = melt(DAG,id.vars = 'Address') %>% filter(value ==1) %>% select(c(1,2))
colnames(direction) = c('From', 'To')
direction= direction %>% left_join(Region, by = c('From' = 'address' ))
colnames(direction)[3:4] = c('From_Y', 'From_X')
direction = direction %>% left_join(Region, by = c('To' = 'address' ))
colnames(direction)[5:6] = c('To_Y', 'To_X')
load('C:/Users/Sion Park/Downloads/covid_19_data.csv/china.Rdata')
ggmap(china) + #geom_point(data = Region, aes(x = Longitude, y= Latitude))+
geom_text(data= Region ,aes(x = Longitude, y= Latitude+0.3, label = address))+
geom_segment(data = direction, aes(x = From_X, y= From_Y, xend = To_X, yend = To_Y, col = From),
arrow = arrow(length = unit(0.2,'cm'),type = 'closed', angle = 25) , size = 0.85)+
ggtitle('COVID-19 in China')+
theme(plot.title  =  element_text(hjust = 0.5))
#### Hubei, Henan, Guangdong, Zhejiang
################################ korea
